# GoTradeTalk Notebook E2E 驗收清單（Gate）

## 0. 驗收規則
- 驗收方式: 必須實際端到端操作，不接受僅單元測試或代碼檢查。
- 通過標準: 關鍵用例全部 `PASS` 才可標記通過。
- 證據要求: 每條用例需保留操作步驟、實際結果、關鍵 API/日志、截圖或錄屏。

## 1. 環境前置
- 環境:
  - Hub Backend 已部署並可連線 Postgres/Qdrant
  - `gotradetalk-ui` 應用端可登入
  - 行動端 App 可登入（至少一台測試機）
- 帳號:
  - `staff_user_a`
  - `staff_user_b`
  - `client_user_a`
  - `company_admin_a`
- 數據:
  - 至少 1 份 PDF 產品目錄
  - 至少 1 份 Excel 規格表（含多個 sheet）
  - 至少 1 份 Markdown/TXT 測試文件

## 2. 關鍵用例（Blocking）

### UAT-01 Staff 基本記事本 CRUD
- 步驟:
  1. `staff_user_a` 登入
  2. 進入 Notebook 模組
  3. 新增文字筆記
  4. 編輯並保存
  5. 刪除筆記
- 預期:
  - 全流程無錯誤
  - 列表與明細狀態一致

### UAT-02 Client 只有基本記事本能力
- 步驟:
  1. `client_user_a` 登入
  2. 進入 Notebook 模組
  3. 檢查聊天頁是否有 AI 圖示與「調用知識庫」
  4. 嘗試直接調用 assist API
- 預期:
  - Client 可正常使用 Notebook 基本功能
  - AI 入口不顯示
  - assist API 返回 `403 FORBIDDEN_ROLE`

### UAT-03 文件上傳與索引狀態
- 步驟:
  1. Staff 上傳 `pdf/docx/csv/xlsx` 測試檔
  2. 查看每筆文件 `index_status`
  3. 檢查索引完成後是否可被檢索
- 預期:
  - 文件可上傳並建立記錄
  - 狀態從 `pending -> running -> success/failed`
  - 可索引格式能檢索命中

### UAT-04 Excel 可檢索與引用定位
- 步驟:
  1. 上傳含多 sheet 的 Excel
  2. 提問「某產品是否有某功能」
  3. 查看引用
- 預期:
  - 回答可命中對應內容
  - 引用含 `sheet + row range`

### UAT-05 聊天「調用知識庫」5句上下文
- 步驟:
  1. 在 staff 聊天房連續發送多句
  2. 在某條訊息點「調用知識庫」
  3. 檢查請求上下文消息數
- 預期:
  - 會帶入 anchor 往前 5 句
  - 返回建議回覆與來源

### UAT-06 AI 輸出框操作閉環
- 步驟:
  1. 觸發 AI 建議回覆
  2. 在 AI 輸出框編輯文本
  3. 點擊「套用到輸入框」
  4. 點擊「直接發送」
- 預期:
  - 兩條路徑都可正常工作
  - 發送內容與最終編輯一致

### UAT-07 反幻覺行為
- 步驟:
  1. 問一個知識庫內不存在的產品功能
  2. 檢查回覆與引用
- 預期:
  - 不得捏造功能
  - 必須回覆證據不足（或等價提示）
  - 不可給出虛構引用

### UAT-08 低信心保護
- 步驟:
  1. 使用模糊問題觸發低信心回答
  2. 觀察 UI 與發送控制
- 預期:
  - 顯示低信心提示
  - 直接發送按鈕按策略禁用

### UAT-09 離線查看與離線編輯（應用端）
- 步驟:
  1. Staff 在線打開筆記
  2. 斷網
  3. 查看與編輯筆記
  4. 恢復網路
- 預期:
  - 斷網可讀可寫
  - 恢復後自動同步成功
  - 無重複、無丟失

### UAT-10 離線查看與離線編輯（App 端）
- 步驟:
  1. 在手機端重複 UAT-09
- 預期:
  - 行為與應用端一致

### UAT-11 多裝置同步一致性
- 步驟:
  1. `staff_user_a` 在裝置 A 修改筆記
  2. 在裝置 B 驗證更新
- 預期:
  - 指定 SLA 時間內可見更新
  - revision 連續且無回退

### UAT-12 同步衝突處理
- 步驟:
  1. 裝置 A/B 同時離線修改同一筆記
  2. 先後恢復連網
- 預期:
  - 系統可偵測衝突
  - 按策略（LWW/衝突副本）處理
  - 使用者可看到衝突提示

### UAT-13 權限隔離（Tenant）
- 步驟:
  1. 在公司 A 建立筆記與檔案
  2. 公司 B 帳號嘗試檢索與查詢
- 預期:
  - 不可讀取、不可檢索命中

### UAT-14 Company Admin 設定生效
- 步驟:
  1. 關閉公司 LLM 能力
  2. Staff 驗證 AI 入口
  3. 再開啟能力並重測
- 預期:
  - 關閉時 UI 隱藏 + API `403 CAPABILITY_DISABLED`
  - 開啟後恢復正常

### UAT-15 觀測與審計
- 步驟:
  1. 執行一次 assist 流程
  2. 查詢審計日志
- 預期:
  - 記錄包含: 用戶、房間、來源、耗時、採用動作

## 3. 非阻塞用例（Non-Blocking）
- UI 細節、文案、動畫
- 非核心格式兼容（如極端 Office 版本）

## 4. 驗收報告模板
- 用例編號:
- 執行人:
- 執行時間:
- 版本/Commit:
- 步驟摘要:
- 實際結果:
- 證據鏈接:
- 判定: `PASS` / `FAIL`
- 備註:

## 5. 通過判定
- `UAT-01` ~ `UAT-15` 全部 `PASS` -> 才可標記「可上線/可進下一階段優化」。
- 任一 Blocking 用例 `FAIL` -> 退回修復，不得通過。
